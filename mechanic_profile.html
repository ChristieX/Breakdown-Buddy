<!DOCTYPE html>
<html>
<head>
  <title>Mechanic's Profile</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
</head>
<body>
  <h1>Mechanic's Profile</h1>
  <h2>Client Geolocation</h2>
  <button id="viewLocationBtn">View Client's Location</button>
  <p id="locationOutput"></p>
  <div id="map" style="height: 400px;"></div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('viewLocationBtn').addEventListener('click', function() {
        getClientLocation();
      });
    });

    function initMap(latitude, longitude) {
      let map = L.map('map').setView([latitude, longitude], 15);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map);
      L.marker([latitude, longitude]).addTo(map)
        .bindPopup("Client's Location")
        .openPopup();
    }

    function getClientLocation() {
      fetch('get_location.php')  // Replace with your PHP script URL
        .then(response => response.json())
        .then(data => {
          if (data.status === 'success') {
            const latitude = parseFloat(data.latitude);
            const longitude = parseFloat(data.longitude);
            document.getElementById('locationOutput').innerHTML = `Latitude: ${latitude}, Longitude: ${longitude}`;
            if (!isNaN(latitude) && !isNaN(longitude)) {
              initMap(latitude, longitude);
            } else {
              console.error('Invalid latitude or longitude values.');
            }
          } else {
            console.error('Error retrieving client location:', data.message);
          }
        })
        .catch(error => {
          console.error('Error retrieving client location:', error);
        });
    }
  </script>
</body>
</html>
